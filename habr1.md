Асинхронный django: status update

Всем привет. Некоторое время назад я писал про альтернативные 
возможности, как можно добавить в django асинхронность, кроме официального 
подхода 
(DEP-09). Хочу сказать, у меня получилось оформить свои идеи в нечто цельное, что 
я назвал [*vinyl project*](https://github.com/pwtail/vinyl). 
Описание проекта можно найти на гитхабе, здесь же я хочу рассказать об 
используемом подходе и остановиться на интересных моментах.

В отличие от официального подхода (DEP-09), проект имеет целью
поддержку нативной асинхронности для проектов с django.

Проект родился после нескольких предыдущих попыток, когда я узнал, что 
django, в действительности, очень неплохо расширяем. Например, он поддерживает 
использование 
нескольких баз данных одновременно, притом что модели одни и те же. 
Соответственно, ничего не мешает считать использование асинхронного драйвера 
как использование другой логической базы данных, чем я и воспользовался.

В результате, получилось поместить всю асинхронную функциональность внутрь 
менеджера моделей. Не понадобилось делать форк django или его частей. 

Вначале - небольшое демо того, что получилось. Для тестирования я 
использовал асинхронный драйвер [psycopg3](https://www.psycopg.org/psycopg3/)).

```python
from django.db import models
from vinyl.manager import VinylManager

class Entry(models.Model):
    x = models.IntegerField()
    
    vinyl = VinylManager()
```

`Entry` - обычная модель django. Можно пользоваться `Entry.objects` в полном 
соответствии с документацией django. Кроме этого, можно писать такой 
асинхронный код:

```python
from django.db.models import Avg

await Entry.vinyl.filter(x__gt=a, x__lt=b).aggregate(Avg('x'))
```

API для работы с кверисетами такой же как в django. Попробуем создать объект:

```python
obj = Entry.vinyl(x=1)
await obj.insert()
```

Как видим, здесь API несколько другой. Для создания объекта используется сам 
менеджер, а для сохранения объекта используется `.insert()` вместо `.save()`.
Сделаем апдейт:

```python
await obj.update(x=2)
```

Опять другой API. CRUD-операции с объектами действительно отличаются от тех, 
которые в django. *vinyl* делает выбор в пользу более явного API. Об этом 
подробнее ниже.